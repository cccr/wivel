<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WIveL.today</title>
    <script src="http://localhost:8082/auth/js/keycloak.js"></script>
    <script>
        var keycloak = Keycloak();
        keycloak.init().success(function (authenticated) {
            console.log(authenticated ? "authenticated" : "not authenticated");
        }).error(function () {
            console.error("failed to initialize");
        });
    </script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script>

        const CONST = {
            note: {
                submitUrl: "/notes"
            }
        };

        var getResponse = function (xhr) {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    // recievedData = JSON.parse(xhr.responseText);
                    gebi('data').innerHTML = xhr.responseText;
                } else {
                    alert("There was a problem with the request to data.json.");
                }
            }
        };
        var fillData = function (xhr) {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    // recievedData = JSON.parse(xhr.responseText);
                    gebi('notes').innerHTML = xhr.responseText;
                } else {
                    alert("There was a problem with the request to data.json.");
                }
            }
        };

        ready(function () {
            var form = gebi("noteForm");
            form.addEventListener("submit", formSubmit, true);
        });

        var formSubmit = function (e) {
            e.preventDefault();
            post(CONST.note.submitUrl, {
                text: gevbi("noteText"),
                tags: gevbi("noteTags").split(" ")
            }, LOGGER);
            return false;
        };

        var getByTag = function (e) {
            get(`/notes/search/findByTagsName?tag=${gevbi("tag")}`, fillData)
        }

    </script>
</head>
<body>
<a onclick="keycloak.login()">login</a><br>
<a onclick="keycloak.logout()">logout</a><br>
<a onclick="get('/user/hello', getResponse)">get data</a><br>
<div id="data"></div>
<hr>
<h2>add</h2>
<a onclick="get('/notes', fillData)">get mongo data</a><br>
<form id="noteForm">
    <label for="noteText">note:</label><textarea id="noteText"></textarea><br>
    <label for="noteTags">tags:</label><input id="noteTags"/>
    <div>
        <button type="submit">save</button>
    </div>
</form>
<hr>
<h2>by Tags</h2>
<label for="tag">tag</label><input id="tag"/>
<a onclick="getByTag()">get mongo data</a><br>
<hr>
<h2>data</h2>
<div id="notes"></div>
</body>
</html>